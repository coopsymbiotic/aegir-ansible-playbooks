---

- include_tasks: Drupal7/settings.yml

- name: Drupal7 | Run fix permissions
  shell:
    chdir: "{{ site_path }}"
    cmd: "/usr/local/aegir-ansible-playbooks/bin/fix-drupal-permissions.sh --site-path='{{ site_path }}'"
  tags:
    - drupal-fixpermissions

# @todo Remove the cron if the CiviCRM plugin is disabled
- include_tasks: Drupal7/civicrm-cron.yml
  when:
    - "'civicrm_sites' in group_names"
    - civicrm_ansible_cron_interval is defined
    - civicrm_ansible_cron_interval|int > 0
  tags:
    - cron-civicrm

- include_tasks: Drupal7/civicrm-cron-remove.yml
  when: civicrm_ansible_cron_interval is undefined or civicrm_ansible_cron_interval|int <= 0
  tags:
    - cron-civicrm

- include_tasks: Drupal7/cms-cron.yml
  when: cms_cron_interval is defined and cms_cron_interval|int > 0
  tags:
    - cron-cms

- include_tasks: Drupal7/cms-cron-remove.yml
  when: cms_cron_interval is undefined or cms_cron_interval|int <= 0
  tags:
    - cron-cms
